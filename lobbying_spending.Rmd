---
title: "Real Estate Lobby's Open Door in Albany"
output:
  html_document:
    theme: journal
    toc: true
    toc_depth: 2
    toc_float: true
---

```{r setup, include=FALSE}
library(tidyverse)
library(googlesheets4)
library(janitor)
library(RPublica) #https://www.r-project.org/nosvn/pandoc/RPublica.html
library(curl)
library(httr)
library(jsonlite)
library(RSocrata)
library(DT)
library(downloadthis)
library(scales)



knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = F)

options(scipen = 999)
```

From 2019 to 2023, the Real Estate industry spent more than \$13 millions dollars on lobbying in Albany. This data analysis digs into the organizations who spent money in Albany over the period, who they paid, and where the money went. 

Using data from the New York State Commission on Ethics and Lobbying in Government via [NY Open Data](https://data.ny.gov/Transparency/Lobbyist-Bi-Monthly-Reports-Beginning-2019/t9kf-dqbc/about_data), this analysis focuses on six of the top lobbying clients in the state: the Real Estate Board of New York, Inc, Homeowners for an Affordable New York LLC, Taxpayers for an Affordable NY LLC, Community Housing Improvement Program (CHIP), Rent Stabilization Association of NYC, INC, and the NYS Association of Realtors. 

There are three different types of data available from the state lobbying records.

-   Compensation for lobbyists

-   Expenses and spending by lobbyists

-   Lobbying activities and targets

```{r, include=FALSE}
beneficial_client_names <- c('TAXPAYERS FOR AN AFFORDABLE NY, INC.;' , 'Homeowners for an Affordable New York LLC;' , 'REAL ESTATE BOARD OF NEW YORK, INC.;' , 'COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.;' , 'RENT STABILIZATION ASSOCIATION OF NYC, INC.;', 'ASSOCIATION OF REALTORS (NYS);')

principal_lobbyist_names <- c('TAXPAYERS FOR AN AFFORDABLE NY, INC.','Homeowners for an Affordable New York LLC','REAL ESTATE BOARD OF NEW YORK, INC.','COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.' , 'RENT STABILIZATION ASSOCIATION OF NYC, INC.', "ASSOCIATION OF REALTORS (NYS)")

```

```{r include=F}
combined <- read_csv(URLencode(
  "https://data.ny.gov/resource/t9kf-dqbc.csv?$where=beneficial_client_name = 'TAXPAYERS FOR AN AFFORDABLE NY, INC.;' OR beneficial_client_name = 'Homeowners for an Affordable New York LLC;' OR beneficial_client_name = 'REAL ESTATE BOARD OF NEW YORK, INC.;' OR beneficial_client_name = 'COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.;' OR beneficial_client_name = 'RENT STABILIZATION ASSOCIATION OF NYC, INC.;' OR principal_lobbyist_name = 'TAXPAYERS FOR AN AFFORDABLE NY, INC.' OR principal_lobbyist_name = 'Homeowners for an Affordable New York LLC' OR principal_lobbyist_name='REAL ESTATE BOARD OF NEW YORK, INC.' OR principal_lobbyist_name = 'COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.' OR principal_lobbyist_name = 'RENT STABILIZATION ASSOCIATION OF NYC, INC.' &$LIMIT= 100000"))

compensation <- combined %>% 
  select(form_submission_id:compensation, unique_id) %>% 
  group_by(form_submission_id) %>% 
  summarize_all(first)

expenses <- combined %>% 
  select(form_submission_id, reporting_year, beneficial_client_name, reimbursed_expenses:coalition_contribution_expense, unique_id) %>% 
  mutate(expense_id = map_chr(str_split(unique_id, "-"), 3))

itemized_expenses <- filter(expenses, expense_id != "0") %>% 
  group_by(expense_id) %>% 
  summarize_all(first)

other_expenses <- filter(expenses, expense_id == "0")

lobbying_activities <- combined %>% 
  select(form_submission_id, reporting_year, beneficial_client_name, lobbying_subjects:unique_id)
```

# 1. Compensation

Compensation data tells us how much real estate clients paid their lobbyists during each bi-monthly reporting period.

## Total Compensation Spending By Real Estate Organizations Since 2019

```{r}
compensation %>% 
  group_by(reporting_year) %>% 
  summarize(total_compensation = sum(compensation)) %>% 
  ggplot()+
  geom_line(mapping = aes(x = reporting_year, y = total_compensation))+
  scale_y_continuous(labels = scales::comma)+
  labs(y = "Dollars ($)",
       x = "Year")

```

The biggest spender was the Real Estate Board of New York, who spent over \$3 million on lobbying in the past five years. Homeowners for an Affordable New York, formed in 2022, spent even more per year - averaging over a million dollars in lobbying compensation a year between 2022 and 2023.

## Lobbying Compensation Over Time by Organization

```{r}
compensation %>% 
  group_by(reporting_year, beneficial_client_name) %>% 
  summarize(total_compensation = sum(compensation)) %>% 
  arrange(beneficial_client_name) %>% 
  pivot_wider(names_from = reporting_year, values_from = total_compensation) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  datatable() %>% 
  formatCurrency(columns = 2:7, digits = 0)
  
```

Sometimes real estate registered as their own lobbyist. But more often, they used a lobbying firm. Fontas Advisors and Greenberg Traurig were paid the most by real estate in the past five years.

## Top Lobbying Groups by Amount Compensated

```{r}
compensation %>% 
  mutate(principal_lobbyist_name = if_else(principal_lobbyist_name == "99 SOLUTIONS, LLC", "99 SOLUTIONS LLC.", principal_lobbyist_name)) %>% 
  group_by(principal_lobbyist_name) %>% 
  summarize(total_compensation = sum(compensation)) %>% 
  arrange(desc(total_compensation)) %>% 
  adorn_totals() %>% 
  datatable() %>% 
  formatCurrency(columns = 2, digits = 0)

```

# 2. Expenses

Lobbying groups also spend millions on particular lobbying expenses on behalf of clients, like advertising and advocacy. Real Estate clients spent an additional \$5 million over the five year period from 2019 to 2023.

## Total Expenses by Year

```{r}

itemized_expenses %>% 
  group_by(reporting_year, beneficial_client_name) %>% 
  summarize(total_expenses = sum(itemized_expenses)) %>% 
  arrange(beneficial_client_name) %>% 
  pivot_wider(names_from = reporting_year, values_from = total_expenses) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  datatable()%>% 
  formatCurrency(columns = 2:6, digits = 0)

```

The majority of those expenses were advertising. Real Estate also spent money on consultants and advocacy - which could include legislative tracking, grassroots advocacy, or phone banking.

## How Real Estate Spent Money to Influence Policy

```{r}
itemized_expenses %>% 
  separate(expense_purpose, sep = " – ", into = c("expense_category", "expense_category_detail")) %>% 
  mutate(expense_category = case_when(
    is.na(expense_category) ~ "Unknown",
    str_detect(expense_category, "Consulting")~"Consulting",
    str_detect(expense_category, "Social Media")~"Advertising",
    T ~ expense_category
  )) %>% 
  group_by(expense_category) %>% 
  summarize(
    number_of_expenses = n(),
    total_expenses = sum(itemized_expenses)
    ) %>% 
  arrange(desc(total_expenses)) %>% 
  adorn_totals() %>% 
  datatable()%>% 
  formatCurrency(columns = 3, digits = 0)
```

```{r}

df <- itemized_expenses %>% 
  separate(expense_purpose, sep = " – ", into = c("expense_category", "expense_category_detail")) %>% 
  mutate(expense_category = case_when(
    is.na(expense_category) ~ "Unknown",
    str_detect(expense_category, "Consulting")~"Consulting",
    str_detect(expense_category, "Social Media")~"Advertising",
    T ~ expense_category
  )) %>% 
  group_by(expense_category) %>% 
  summarize(
    number_of_expenses = n(),
    values = sum(itemized_expenses),
    ) %>% 
  mutate(percentage = values / sum(values) * 100)

ggplot(df, aes(x = "", y = values, fill = expense_category)) +
  geom_bar(stat = "identity") +
  coord_polar("y", start = 0) +
  geom_text(data = df %>% filter(percentage > 2),
            aes(label = paste0(round(percentage), "%")), 
            position = position_stack(vjust = 0.5), 
            color = "white", size = 3) +
  scale_fill_brewer(palette = "Dark2") +
  theme_void() +
  theme(legend.position = "bottom") +
  theme(axis.text.x=element_blank(),
        legend.title = element_blank())



ggsave("pie.svg")

```

# 3. Targets of Lobbying

Lobbying data also tells us how often lobbyists reached out to particular legislators on behalf of a client, and what issues they lobbied them about.

Unsurprisingly, Real Estate lobbied mostly about real estate, housing, and construction, but also played a big role in budget and tax negotiations. This data includes who real estate lobbied and on what issues and laws at both the city and state level.

Lobbyists working for real estate lobbied about Good Cause Eviction the most, more than any other piece of city or state legislation in the past five years.

## Most Targeted Laws

```{r}

lobbying_activities %>%
  mutate(bill = case_when(
    focus_identifying_number == "A4740-A" ~ "Green Roof Tax Abatement",
    focus_identifying_number == "S5554-A" ~ "Green Roof Tax Abatement",
    focus_identifying_number == "A9006-A" ~ "Education, Labor, Housing and family assistance budget",
    focus_identifying_number == "S3082" ~ "Good Cause",
    focus_identifying_number == "A5573" ~ "Good Cause",
    focus_identifying_number == 'A4454' ~ "Good Cause",
    focus_identifying_number == "S8006-A" ~ "Education, Labor, Housing and family assistance budget",
    focus_identifying_number == "S2892" ~"Good Cause",
    focus_identifying_number == "A3006" ~ "Education, Labor, Housing and family assistance budget",
    focus_identifying_number == "A2008C" ~ "Transportation, economic development, environmental conservation budget",
    focus_identifying_number == "S1508" ~ "Transportation, economic development, environmental conservation budget",
    focus_identifying_number == "A2008" ~ "Transportation, economic development, environmental conservation budget",
    focus_identifying_number == "S1947" ~ "Hours, Wages, and supplements in contracts for public work",
    focus_identifying_number == "A1261" ~ "Hours, Wages, and supplements in contracts for public work",
    focus_identifying_number == "A1915" ~ "Prevailing wage in large city developments",
    focus_identifying_number == "S305" ~ "Good Cause",
    focus_identifying_number == 'Intended introduction regarding good cause eviction' ~ "Good Cause",
    focus_identifying_number == 'Local Law 1 (Lander)' ~ "Lead Paint Local Law 1",
    focus_identifying_number == 'CONH Bill' ~ "Certificate of No Harrassment",
    focus_identifying_number == 'CONH Bill' ~ "Certificate of No Harrassment",
    T ~ focus_identifying_number
  )) %>% 
  group_by(bill) %>%
  summarize(contacts= n()) %>% arrange(desc(contacts))%>%
  adorn_totals() %>% 
  filter(bill == "Total" | row_number() <= 10) %>% 
  datatable(caption = 'Note: bill names are cleaned for most targeted laws, but not throughout')

```

## Most Targeted People

```{r}
parties_sum_clean <- lobbying_activities %>%
  mutate(
         party_name_clean = case_when(
    str_detect(party_name,"Kavanagh")~"Brian Kavanagh",
    str_detect(party_name,"Heastie")~"Carl Heastie",
    str_detect(party_name,"Skoufis")~"James Skoufis",
    str_detect(party_name,"Cymbrowitz") ~ "Steven Cymbrowitz",
    str_detect(party_name,"Mannion") ~ "John Mannion",
    #str_detect(party_name,"Adams") ~ "Eric Adams",
    str_detect(party_name,"Johnson") ~ "Corey Johnson",
    str_detect(party_name,"Kaplan") ~ "Anna Kaplan",
    str_detect(party_name,"Kaminsky") ~ "Todd Kaminsky",
    str_detect(party_name,"Stewart-Cousins") ~ "Andrea Stewart-Cousins",
    str_detect(party_name,"Comrie") ~ "Leroy Comrie",
    str_detect(party_name,"Hochul") ~ "Kathy Hochul", #double check this one
    str_detect(party_name,"Executive Chamber") ~ "Executive Chamber",
    str_detect(party_name,"Program and Counsel Staff") ~ "Legislative Leadership",
    
    party_name =="New York State Senate" ~ "General",
    party_name =="New York Assembly" ~ "General",
    party_name =="NYC Council Central Staff" ~ "General",
    party_name =="Homes and Community Renewal (HCR)" ~ "General",
    party_name =="NYC Department of City Planning (DCP)" ~ "General",
    party_name =="NYC Department of Housing Preservation and Development (HPD)" ~ "General",
    party_name =="Division of the Budget" ~ "General",
    party_name =="NYC Department of Buildings (DOB)" ~ "General",
    
    T ~ str_remove_all(party_name, "Senator |Assemblymember |Assembly member ")
  ))

 parties_sum_clean %>% 
  group_by(party_name_clean) %>%
  summarize(contacts= n()) %>% arrange(desc(contacts))%>%
  filter(!party_name_clean %in% c("General", "Executive Chamber", "Legislative Leadership")) %>% 
  #head(10) %>% 
  datatable(caption = 'Note: bill names are cleaned for most targeted legislators and bodies, but not throughout')


```

The open door to real estate extended to senior staff in the executive chamber, and both houses of the legislature, as well as officials in city and state agencies. 

## Most Targeted Entities

```{r}

bodies <- c("New York State Senate",
"New York Assembly",
"NYC Council Central Staff",
"Homes and Community Renewal (HCR)",
"NYC Department of City Planning (DCP)",
"NYC Department of Housing Preservation and Development (HPD)",
"Division of the Budget",
"NYC Department of Buildings (DOB)")

 parties_sum_clean %>% 
  filter(party_name %in% bodies|party_name_clean %in% c("Legislative Leadership", "Executive Chamber")) %>% 
   mutate(party_name = case_when(
    str_detect(party_name,"Executive Chamber") ~ "Executive Chamber",
    str_detect(party_name,"Program and Counsel Staff") ~ "Legislative Leadership",
    party_name == "New York State Senate" ~ "General Communication with State Senate",
    party_name == "New York State Assembly" ~ "General Communication with State Assembly",
    T ~ party_name
   )) %>% 
  group_by(party_name) %>%
  summarize(contacts= n()) %>% arrange(desc(contacts))%>%
  #head(10) %>% 
  datatable(caption = 'Note: bill names are cleaned for most targeted legislators and bodies, but not throughout')

```

# Download all the data

Download the cleaned and filtered data for the investigated organizations here.

## Compensation

```{r}

compensation %>%
  download_this(
    output_name = "real estate compensation dataset",
    output_extension = ".csv",
    button_label = "Download compensation data as csv",
    button_type = "default",
    has_icon = TRUE,
    icon = "fa fa-save"
  )

```

## Expenses

```{r}
itemized_expenses %>%
  download_this(
    output_name = "real estate expenses dataset",
    output_extension = ".csv",
    button_label = "Download expenses data as csv",
    button_type = "default",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

## Lobbying Targets

```{r}
lobbying_activities %>%
  download_this(
    output_name = "real estate lobbying activity dataset",
    output_extension = ".csv",
    button_label = "Download lobbying data as csv",
    button_type = "default",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

The code for this analysis is available on [Github](https://github.com/pspauster/lobbying-research).

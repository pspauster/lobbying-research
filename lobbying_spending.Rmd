---
title: "Lobbying Spending"
output:
  html_document:
    toc: true
    toc_depth: 2
---

```{r setup, include=FALSE}
library(tidyverse)
library(googlesheets4)
library(janitor)
library(RPublica) #https://www.r-project.org/nosvn/pandoc/RPublica.html
library(curl)
library(httr)
library(jsonlite)
library(RSocrata)
library(DT)
library(downloadthis)



knitr::opts_chunk$set(echo = FALSE, warning = FALSE)

options(scipen = 999)
```

From 2019 to 2023, Real Estate spent millions of dollars on lobbying in Albany. This data analysis digs into the organizations who spent money in Albany over the period, who they paid, and where there money went.

It analyzes data from from the New York State Commission on Ethics and Lobbying in Government via [NY Open Data](https://data.ny.gov/Transparency/Lobbyist-Bi-Monthly-Reports-Beginning-2019/t9kf-dqbc/about_data)

# Organizations Investigated

The analysis focuses on the following Real Estate organizations which are some of the top spending lobbying clients in the state.

-   Real Estate Board of New York, Inc
-   Homeowners for an Affordable New York LLC
-   Taxpayers for an Affordable NY LLC
-   Community Housing Improvement Program (CHIP)
-   Rent Stabilization Association of NYC, INC
-   NYS Association of Realtors

```{r, include=FALSE}
beneficial_client_names <- c('TAXPAYERS FOR AN AFFORDABLE NY, INC.;' , 'Homeowners for an Affordable New York LLC;' , 'REAL ESTATE BOARD OF NEW YORK, INC.;' , 'COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.;' , 'RENT STABILIZATION ASSOCIATION OF NYC, INC.;', 'ASSOCIATION OF REALTORS (NYS);')

principal_lobbyist_names <- c('TAXPAYERS FOR AN AFFORDABLE NY, INC.','Homeowners for an Affordable New York LLC','REAL ESTATE BOARD OF NEW YORK, INC.','COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.' , 'RENT STABILIZATION ASSOCIATION OF NYC, INC.', "ASSOCIATION OF REALTORS (NYS)")

```

There are three different types of data available from the state lobbying records.

1.  Compensation for lobbyists
2.  Expenses and spending by lobbyists
3.  Lobbying activities and targets

```{r include=F}
combined <- read_csv(URLencode(
  "https://data.ny.gov/resource/t9kf-dqbc.csv?$where=beneficial_client_name = 'TAXPAYERS FOR AN AFFORDABLE NY, INC.;' OR beneficial_client_name = 'Homeowners for an Affordable New York LLC;' OR beneficial_client_name = 'REAL ESTATE BOARD OF NEW YORK, INC.;' OR beneficial_client_name = 'COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.;' OR beneficial_client_name = 'RENT STABILIZATION ASSOCIATION OF NYC, INC.;' OR principal_lobbyist_name = 'TAXPAYERS FOR AN AFFORDABLE NY, INC.' OR principal_lobbyist_name = 'Homeowners for an Affordable New York LLC' OR principal_lobbyist_name='REAL ESTATE BOARD OF NEW YORK, INC.' OR principal_lobbyist_name = 'COMMUNITY HOUSING IMPROVEMENT PROGRAM, INC.' OR principal_lobbyist_name = 'RENT STABILIZATION ASSOCIATION OF NYC, INC.' &$LIMIT= 100000"))

compensation <- combined %>% 
  select(form_submission_id:compensation, unique_id) %>% 
  group_by(form_submission_id) %>% 
  summarize_all(first)

expenses <- combined %>% 
  select(form_submission_id, reporting_year, beneficial_client_name, reimbursed_expenses:coalition_contribution_expense, unique_id) %>% 
  mutate(expense_id = map_chr(str_split(unique_id, "-"), 3))

itemized_expenses <- filter(expenses, expense_id != "0") %>% 
  group_by(expense_id) %>% 
  summarize_all(first)

other_expenses <- filter(expenses, expense_id == "0")

lobbying_activities <- combined %>% 
  select(form_submission_id, reporting_year, beneficial_client_name, lobbying_subjects:unique_id)
```

# 1. Compensation

Compensation data tells us how much a client paid a lobbyist during a given period. By checking the amount that real estate clients paid their lobbyists every bi-monthly period, we can get an idea of how much they are spending on lobbying.

## Total Compensation spending by all parties since 2019

```{r}
compensation %>% 
  group_by(reporting_year) %>% 
  summarize(total_compensation = sum(compensation)) %>% 
  ggplot()+
  geom_line(mapping = aes(x = reporting_year, y = total_compensation))+
  scale_y_continuous(labels = scales::comma)

```

The biggest spender was the Real Estate Board of New York, who spent over 3 million on lobbying in the past five years. Homeowners for an affordable New York, formed in 2022, spent even more per year - averaging over a million dollars in lobbying compensation a year between 2022 and 2023.

## Lobbying compensation over time by organization

```{r}
compensation %>% 
  group_by(reporting_year, beneficial_client_name) %>% 
  summarize(total_compensation = sum(compensation)) %>% 
  arrange(beneficial_client_name) %>% 
  pivot_wider(names_from = reporting_year, values_from = total_compensation) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  datatable()
  
```

Sometimes real estate registered as their own lobbyist. But more often, they used a lobbying company. Fontas advisors and Greenberg Traurig were paid the most by real estate in the past five years.

## Top Lobbying groups by Amount Compensated

```{r}
compensation %>% 
  mutate(principal_lobbyist_name = if_else(principal_lobbyist_name == "99 SOLUTIONS, LLC", "99 SOLUTIONS LLC.", principal_lobbyist_name)) %>% 
  group_by(principal_lobbyist_name) %>% 
  summarize(total_compensation = sum(compensation)) %>% 
  arrange(desc(total_compensation)) %>% 
  adorn_totals() %>% 
  datatable()

```

# 2. Expenses

Lobbying groups also spent millions on on particular lobbying expenses on behalf of clients, like advertising and advocacy.

Real Estate clients spent \$5 million over five years

## Total itemized expenses by year

```{r}

itemized_expenses %>% 
  group_by(reporting_year, beneficial_client_name) %>% 
  summarize(total_expenses = sum(itemized_expenses)) %>% 
  arrange(beneficial_client_name) %>% 
  pivot_wider(names_from = reporting_year, values_from = total_expenses) %>% 
  adorn_totals(where = c("row", "col")) %>% 
  datatable()

```

The majority of those expenses were advertising. They also spent money on consultants and advocacy - which could be work on legislative tracking, grassroots advocacy, or phone banking

# Types of expenses and their frequency

```{r}
itemized_expenses %>% 
  separate(expense_purpose, sep = " – ", into = c("expense_category", "expense_category_detail")) %>% 
  mutate(expense_category = case_when(
    is.na(expense_category) ~ "Unknown",
    str_detect(expense_category, "Consulting")~"Consulting",
    str_detect(expense_category, "Social Media")~"Advertising",
    T ~ expense_category
  )) %>% 
  group_by(expense_category) %>% 
  summarize(
    number_of_expenses = n(),
    total_expenses = sum(itemized_expenses)
    ) %>% 
  arrange(desc(total_expenses)) %>% 
  adorn_totals() %>% 
  datatable()
```

```{r}
itemized_expenses %>% 
  separate(expense_purpose, sep = " – ", into = c("expense_category", "expense_category_detail")) %>% 
  mutate(expense_category = case_when(
    is.na(expense_category) ~ "Unknown",
    str_detect(expense_category, "Consulting")~"Consulting",
    str_detect(expense_category, "Social Media")~"Advertising",
    T ~ expense_category
  )) %>% 
  group_by(expense_category) %>% 
  summarize(
    number_of_expenses = n(),
    values = sum(itemized_expenses),
    ) %>% 
  ggplot()+
  geom_bar(mapping = aes(x = "", y = values, fill = expense_category), stat = "identity")+
  coord_polar("y", start = 0)+
  scale_fill_brewer("Blues") +
  theme_void() +
  theme(axis.text.x=element_blank(),
        legend.title = element_blank())
# +
#   geom_text(aes(y = values/3 + c(0, cumsum(values)[-length(values)]), 
#                 label = scales::percent(values/100)), size=5)

ggsave("pie.svg")

```

# 3. Targets of Lobbying

Lobbying data also tells us how often lobbyists reached out to particular legislators on behalf of a client, and what issues they lobbied them about.

Unsurprisingly, real estate lobbied mostly about real estate, housing, and construction, but also played a big role in budget and tax negotiations.

## Most targeted Issues

```{r}
lobbying_activities %>% group_by(lobbying_subjects) %>% summarize(contacts= n()) %>% arrange(desc(contacts)) %>% datatable()
```

Lobbyists working for real estate lobbied about good cause eviction the most, more than any other piece of legislation in the past five years.

## Most Targeted Laws

```{r}

lobbying_activities %>%
  mutate(bill = case_when(
    focus_identifying_number == "A4740-A" ~ "Green Roof Tax Abatement",
    focus_identifying_number == "S5554-A" ~ "Green Roof Tax Abatement",
    focus_identifying_number == "A9006-A" ~ "Education, Labor, Housing and family assistance budget",
    focus_identifying_number == "S3082" ~ "Good Cause",
    focus_identifying_number == "A5573" ~ "Good Cause",
    focus_identifying_number == 'A4454' ~ "Good Cause",
    focus_identifying_number == "S8006-A" ~ "Education, Labor, Housing and family assistance budget",
    focus_identifying_number == "S2892" ~"Good Cause",
    focus_identifying_number == "A3006" ~ "Education, Labor, Housing and family assistance budget",
    focus_identifying_number == "A2008C" ~ "Transportation, economic development, environmental conservation budget",
    focus_identifying_number == "S1508" ~ "Transportation, economic development, environmental conservation budget",
    focus_identifying_number == "A2008" ~ "Transportation, economic development, environmental conservation budget",
    focus_identifying_number == "S1947" ~ "Hours, Wages, and supplements in contracts for public work",
    focus_identifying_number == "A1261" ~ "Hours, Wages, and supplements in contracts for public work",
    focus_identifying_number == "A1915" ~ "Prevailing wage in large city developments",
    focus_identifying_number == "S305" ~ "Good Cause",
    focus_identifying_number == 'Intended introduction regarding good cause eviction' ~ "Good Cause",
    T ~ focus_identifying_number
  )) %>% 
  group_by(bill) %>%
  summarize(contacts= n()) %>% arrange(desc(contacts))%>%
  adorn_totals() %>% 
  filter(bill == "Total" | row_number() <= 10) %>% 
  datatable()

```

Real Estate targeted specific legislators frequently, many of them NYC legislators.

## Most targeted people

```{r}
parties_sum_clean <- lobbying_activities %>%
  mutate(
         party_name_clean = case_when(
    str_detect(party_name,"Kavanagh")~"Brian Kavanagh",
    str_detect(party_name,"Heastie")~"Carl Heastie",
    str_detect(party_name,"Skoufis")~"James Skoufis",
    str_detect(party_name,"Cymbrowitz") ~ "Steven Cymbrowitz",
    str_detect(party_name,"Mannion") ~ "John Mannion",
    #str_detect(party_name,"Adams") ~ "Eric Adams",
    str_detect(party_name,"Johnson") ~ "Corey Johnson",
    str_detect(party_name,"Kaplan") ~ "Anna Kaplan",
    str_detect(party_name,"Kaminsky") ~ "Todd Kaminsky",
    str_detect(party_name,"Stewart-Cousins") ~ "Andrea Stewart-Cousins",
    str_detect(party_name,"Comrie") ~ "Leroy Comrie",
    str_detect(party_name,"Hochul") ~ "Kathy Hochul", #double check this one
    str_detect(party_name,"Executive Chamber") ~ "Executive Chamber",
    str_detect(party_name,"Program and Counsel Staff") ~ "Legislative Leadership",
    
    party_name =="New York State Senate" ~ "General",
    party_name =="New York Assembly" ~ "General",
    party_name =="NYC Council Central Staff" ~ "General",
    party_name =="Homes and Community Renewal (HCR)" ~ "General",
    party_name =="NYC Department of City Planning (DCP)" ~ "General",
    party_name =="NYC Department of Housing Preservation and Development (HPD)" ~ "General",
    party_name =="Division of the Budget" ~ "General",
    party_name =="NYC Department of Buildings (DOB)" ~ "General",
    
    T ~ str_remove_all(party_name, "Senator |Assemblymember |Assembly member ")
  ))

 parties_sum_clean %>% 
  group_by(party_name_clean) %>%
  summarize(contacts= n()) %>% arrange(desc(contacts))%>%
  filter(!party_name_clean %in% c("General", "Executive Chamber", "Legislative Leadership")) %>% 
  #head(10) %>% 
  datatable()


```

But their influence also extended to the highest halls of power, frequently lobbying the executive chamber in the governor's office, and minority and majority program staff and representatives in the legislature.

## Most targeted bodies

```{r}

bodies <- c("New York State Senate",
"New York Assembly",
"NYC Council Central Staff",
"Homes and Community Renewal (HCR)",
"NYC Department of City Planning (DCP)",
"NYC Department of Housing Preservation and Development (HPD)",
"Division of the Budget",
"NYC Department of Buildings (DOB)")

 parties_sum_clean %>% 
  filter(party_name %in% bodies|party_name_clean %in% c("Legislative Leadership", "Executive Chamber")) %>% 
   mutate(party_name = case_when(
    str_detect(party_name,"Executive Chamber") ~ "Executive Chamber",
    str_detect(party_name,"Program and Counsel Staff") ~ "Legislative Leadership",
    T ~ party_name
   )) %>% 
  group_by(party_name) %>%
  summarize(contacts= n()) %>% arrange(desc(contacts))%>%
  #head(10) %>% 
  datatable()

```

# Download all the data

Download the cleaned and filtered data for the investigated organizations here.

## Compensation

```{r}

compensation %>%
  download_this(
    output_name = "real estate compensation dataset",
    output_extension = ".csv",
    button_label = "Download compensation data as csv",
    button_type = "default",
    has_icon = TRUE,
    icon = "fa fa-save"
  )

```

## Expenses

```{r}
itemized_expenses %>%
  download_this(
    output_name = "real estate expenses dataset",
    output_extension = ".csv",
    button_label = "Download expenses data as csv",
    button_type = "default",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

## Lobbying contacts

```{r}
lobbying_activities %>%
  download_this(
    output_name = "real estate lobbying activity dataset",
    output_extension = ".csv",
    button_label = "Download lobbying data as csv",
    button_type = "default",
    has_icon = TRUE,
    icon = "fa fa-save"
  )
```

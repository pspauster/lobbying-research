---
title: "JCOPE ANALYSIS"
author: "Patrick Spauster"
date: "2023-09-18"
output: html_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(googlesheets4)
library(janitor)
library(RPublica) #https://www.r-project.org/nosvn/pandoc/RPublica.html
library(curl)
library(httr)
library(jsonlite)

knitr::opts_chunk$set(echo = TRUE)
```

```{r}

sof <- read_sheet("https://docs.google.com/spreadsheets/d/1G_5dkzSlSvbVwM7Q-NItgntBawFXDoZaFoq4XPoTSLE/edit#gid=78477068", 
                  sheet = "Sources of Funding",
                  col_types = "ccccDd????") %>% 
  clean_names()

```

```{r}
sof %>% 
  group_by(name) %>% 
  summarize(total_contributions = sum(amount_of_contribution, na.rm = T),
            )

sof %>% 
  filter(!is.na(amount_of_contribution)) %>% 
  count(amount_of_contribution == 0)
```

```{r}



```



```{r}

campaign_finance_filers <- read_csv("Data/COMMCAND.CSV",
                                    col_names = F)

names(campaign_finance_filers) <- c("filer_id", "filer_name", "compliance_type_desc", "filter_type_desc", "filer_status", "committee_type_desc",
                                    "office_desc", "district", "county_desc", "municipality_desc_subdivision_desc", "treasurer_first_name",  "treasurer_middle_name", "treasurer_last_name", "address", "city", "state", "zipcode")

pacs <- c("Taxpayers For An Affordable New York Pac", "Real Estate Board PAC", "Jobs For New York", "Rsa Pac")

```

```{r}
real_estate_pacs_filers <- campaign_finance_filers %>% 
  filter(filer_name %in% pacs)

```


```{r}




```







```{r}

q = curl_escape("real estate board")

state = "NY"

base_url <- "https://projects.propublica.org/nonprofits/api/v2/search.json"

url_enc <- URLencode(paste0(base_url,
                            "?",
                            "q=",
                            q,
                            "&state%5Bid%5D=", state))

result <- GET(url_enc)

search <- fromJSON(rawToChar(result$content))

orgs <- search$organizations


```


```{r}

chip <- "132617766"
  
rsa <- "132634120"

rebny <- "131201480"





org_url <- "https://projects.propublica.org/nonprofits/api/v2/organizations/" 

ein <- rebny_id

org_url_enc <- URLencode(paste0(org_url, ein, ".json"))

org_result <- GET(org_url_enc)

rawToChar(org_result$content)

org_result <- fromJSON(content(org_result, as = "text"), flatten = TRUE)

org <- org_result$organization
org_filings_d <- org_result$filings_with_data

```
Field descriptions
https://projects.propublica.org/nonprofits/api/#organization-object
https://www.irs.gov/pub/irs-soi/12eofinextractdoc.xls

This filing data doesn't have the schedule F though...


